{{ 'countdown.css' | asset_url | stylesheet_tag }}
<div class="todays-offer-section container-fluid py-40" style="max-width: 100vw;">
  <div class="todays-offer-grid flex flex-wrap gap-32 justify-center align-items-stretch">
    <!-- Sản phẩm phụ bên trái -->
    <div class="todays-offer-side grid grid-cols-2 gap-16 flex-1" style="max-width: 400px; min-width: 320px;">
      {% for product in section.settings.side_products_left limit: 4 %}
        <div class="todays-offer-side-item bg-white rounded-8 p-12 flex flex-col justify-between shadow-sm">
          <a href="{{ product.url }}" class="block mb-8">
            <img src="{{ product.featured_image | img_url: '240x' }}" alt="{{ product.title }}" class="w-full rounded-6" loading="lazy" width="240px" height="240px">
          </a>
          <div class="fw-600 fs-15 mb-4 line-clamp-2">{{ product.title }}</div>
          <div class="flex align-center gap-6 mb-4">
            {% render 'review', product: product %}
            <span class="fs-13 text-muted">({{ product.metafields.reviews.rating_count | default: 0 }})</span>
          </div>
          <div class="fw-700 fs-16 text-danger mb-4">{{ product.price | money }}</div>
          <div class="flex align-center gap-6">
            <span class="fs-13 text-muted">In stock: {{ product.inventory_quantity | default: 0 }}</span>
            {% if product.inventory_quantity > 10 %}
              <span class="stock-check-icon" title="In stock">
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.252 0.251953L4.25 6.25391L1.74805 3.75195C1.62956 3.64258 1.48828 3.58789 1.32422 3.58789C1.16927 3.58789 1.03711 3.64258 0.927734 3.75195C0.809245 3.87044 0.75 4.01172 0.75 4.17578C0.75 4.33073 0.809245 4.46289 0.927734 4.57227L3.83984 7.49805C3.94922 7.60742 4.08594 7.66211 4.25 7.66211C4.41406 7.66211 4.55078 7.60742 4.66016 7.49805L11.0723 1.07227C11.1908 0.962891 11.25 0.830729 11.25 0.675781C11.25 0.511719 11.1908 0.370443 11.0723 0.251953C10.9629 0.142578 10.8262 0.0878906 10.6621 0.0878906C10.5072 0.0878906 10.3704 0.142578 10.252 0.251953Z" fill="#008A00"/></svg>
              </span>
            {% else %}
              <span class="stock-check-icon" title="Low stock">
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.252 0.251953L4.25 6.25391L1.74805 3.75195C1.62956 3.64258 1.48828 3.58789 1.32422 3.58789C1.16927 3.58789 1.03711 3.64258 0.927734 3.75195C0.809245 3.87044 0.75 4.01172 0.75 4.17578C0.75 4.33073 0.809245 4.46289 0.927734 4.57227L3.83984 7.49805C3.94922 7.60742 4.08594 7.66211 4.25 7.66211C4.41406 7.66211 4.55078 7.60742 4.66016 7.49805L11.0723 1.07227C11.1908 0.962891 11.25 0.830729 11.25 0.675781C11.25 0.511719 11.1908 0.370443 11.0723 0.251953C10.9629 0.142578 10.8262 0.0878906 10.6621 0.0878906C10.5072 0.0878906 10.3704 0.142578 10.252 0.251953Z" fill="#E53935"/></svg>
              </span>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
    <!-- Sản phẩm nổi bật ở giữa -->
    <div class="todays-offer-main border rounded-10 p-40 flex-2 bg-white shadow-md" style="max-width: 520px; min-width: 340px;">
      <div class="todays-offer-badge mb-10">
        {% if section.settings.main_badge != blank %}
          <span class="badge badge-danger">{{ section.settings.main_badge }}</span>
        {% endif %}
      </div>
      <div class="todays-offer-title mb-10 fs-22 fw-700">{{ section.settings.main_title }}</div>
      <div class="todays-offer-image mb-20 text-center">
        <a href="{{ section.settings.main_product.url }}">
          <img src="{{ section.settings.main_product.featured_image | img_url: '480x' }}" alt="{{ section.settings.main_product.title }}" width="420" height="420" class="rounded-8 mx-auto">
        </a>
      </div>
      <div class="todays-offer-product-title mb-5 fw-600 fs-18 text-center">
        <a href="{{ section.settings.main_product.url }}">{{ section.settings.main_product.title }}</a>
      </div>
      <div class="todays-offer-rating mb-5 flex align-center justify-center gap-6">
        {% render 'review', product: section.settings.main_product %}
        <span class="fs-14 text-muted">({{ section.settings.main_product.metafields.reviews.rating_count | default: 0 }})</span>
      </div>
      <div class="todays-offer-price mb-10 text-center">
        <span class="text-danger fs-24 fw-700">{{ section.settings.main_product.price | money }}</span>
        {% if section.settings.main_product.compare_at_price > section.settings.main_product.price %}
          <span class="text-muted text-line-through ms-2 fs-16">
            {{- section.settings.main_product.compare_at_price | money -}}
          </span>
        {% endif %}
      </div>
      <div class="todays-offer-countdown mb-10 text-center">
        <countdown-timer
          data-endtime="{{ section.settings.countdown_endtime }}"
          data-format="dd:hh:mm:ss"
          data-days="Days"
          data-hours="Hours"
          data-mins="Min"
          data-secs="Sec"
        ></countdown-timer>
      </div>
      <div class="todays-offer-progress mb-10">
        <div class="progress-bar" style="height: 10px; background: #eee; border-radius: 10px;">
          <div style="width: {{ section.settings.progress_percent }}%; background: #e53935; height: 100%; border-radius: 10px;"></div>
        </div>
        <div class="fs-13 mt-2 text-center">Sold: {{ section.settings.sold }}/{{ section.settings.total }}</div>
      </div>
      <div class="todays-offer-buy mt-20 text-center">
        <a href="{{ section.settings.main_product.url }}" class="btn btn-primary w-full">Buy Now</a>
      </div>
    </div>
    <!-- Sản phẩm phụ bên phải -->
    <div class="todays-offer-side grid grid-cols-2 gap-16 flex-1" style="max-width: 400px; min-width: 320px;">
      {% for product in section.settings.side_products_right limit: 4 %}
        <div class="todays-offer-side-item bg-white rounded-8 p-12 flex flex-col justify-between shadow-sm">
          <a href="{{ product.url }}" class="block mb-8">
            <img src="{{ product.featured_image | img_url: '240x' }}" alt="{{ product.title }}" class="w-full rounded-6" loading="lazy" width="240px" height="240px">
          </a>
          <div class="fw-600 fs-15 mb-4 line-clamp-2">{{ product.title }}</div>
          <div class="flex align-center gap-6 mb-4">
            {% render 'review', product: product %}
            <span class="fs-13 text-muted">({{ product.metafields.reviews.rating_count | default: 0 }})</span>
          </div>
          <div class="fw-700 fs-16 text-danger mb-4">{{ product.price | money }}</div>
          <div class="flex align-center gap-6">
            <span class="fs-13 text-muted">In stock: {{ product.inventory_quantity | default: 0 }}</span>
            {% if product.inventory_quantity > 10 %}
              <span class="stock-check-icon" title="In stock">
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.252 0.251953L4.25 6.25391L1.74805 3.75195C1.62956 3.64258 1.48828 3.58789 1.32422 3.58789C1.16927 3.58789 1.03711 3.64258 0.927734 3.75195C0.809245 3.87044 0.75 4.01172 0.75 4.17578C0.75 4.33073 0.809245 4.46289 0.927734 4.57227L3.83984 7.49805C3.94922 7.60742 4.08594 7.66211 4.25 7.66211C4.41406 7.66211 4.55078 7.60742 4.66016 7.49805L11.0723 1.07227C11.1908 0.962891 11.25 0.830729 11.25 0.675781C11.25 0.511719 11.1908 0.370443 11.0723 0.251953C10.9629 0.142578 10.8262 0.0878906 10.6621 0.0878906C10.5072 0.0878906 10.3704 0.142578 10.252 0.251953Z" fill="#008A00"/></svg>
              </span>
            {% else %}
              <span class="stock-check-icon" title="Low stock">
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.252 0.251953L4.25 6.25391L1.74805 3.75195C1.62956 3.64258 1.48828 3.58789 1.32422 3.58789C1.16927 3.58789 1.03711 3.64258 0.927734 3.75195C0.809245 3.87044 0.75 4.01172 0.75 4.17578C0.75 4.33073 0.809245 4.46289 0.927734 4.57227L3.83984 7.49805C3.94922 7.60742 4.08594 7.66211 4.25 7.66211C4.41406 7.66211 4.55078 7.60742 4.66016 7.49805L11.0723 1.07227C11.1908 0.962891 11.25 0.830729 11.25 0.675781C11.25 0.511719 11.1908 0.370443 11.0723 0.251953C10.9629 0.142578 10.8262 0.0878906 10.6621 0.0878906C10.5072 0.0878906 10.3704 0.142578 10.252 0.251953Z" fill="#E53935"/></svg>
              </span>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Today's Offer",
  "settings": [
    {
      "type": "product",
      "id": "main_product",
      "label": "Sản phẩm nổi bật"
    },
    {
      "type": "text",
      "id": "main_title",
      "label": "Tiêu đề khuyến mãi",
      "default": "TODAY'S OFFER"
    },
    {
      "type": "text",
      "id": "main_badge",
      "label": "Badge giảm giá",
      "default": "-20%"
    },
    {
      "type": "text",
      "id": "countdown_endtime",
      "label": "Thời gian kết thúc (YYYY-MM-DD HH:MM:SS)"
    },
    {
      "type": "number",
      "id": "progress_percent",
      "label": "Phần trăm đã bán (progress bar)",
      "default": 60
    },
    {
      "type": "number",
      "id": "sold",
      "label": "Số lượng đã bán",
      "default": 620
    },
    {
      "type": "number",
      "id": "total",
      "label": "Tổng số lượng",
      "default": 896
    },
    {
      "type": "product_list",
      "id": "side_products_left",
      "label": "Sản phẩm phụ bên trái"
    },
    {
      "type": "product_list",
      "id": "side_products_right",
      "label": "Sản phẩm phụ bên phải"
    }
  ],
  "presets": [
    {
      "name": "Today's Offer"
    }
  ]
}
{% endschema %}

<style>
  .todays-offer-section.container-fluid {
    max-width: 100vw;
    padding-left: 0;
    padding-right: 0;
  }
  .todays-offer-grid {
    width: 100%;
    gap: 32px;
    align-items: stretch;
  }
  .todays-offer-side {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    max-width: 400px;
    min-width: 320px;
  }
  .todays-offer-side-item {
    background: #fff;
    border-radius: 8px;
    padding: 12px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  }
  .todays-offer-main {
    background: #fff;
    box-shadow: 0 4px 24px rgba(0,0,0,0.08);
    max-width: 520px;
    min-width: 340px;
    padding: 40px;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .todays-offer-image img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
  }
  .stock-check-icon {
    display: inline-flex;
    align-items: center;
    margin-left: 4px;
  }
  @media (max-width: 1200px) {
    .todays-offer-side {
      max-width: 320px;
    }
    .todays-offer-main {
      max-width: 400px;
      padding: 24px;
    }
  }
  @media (max-width: 900px) {
    .todays-offer-grid {
      flex-direction: column;
      align-items: center;
      gap: 24px;
    }
    .todays-offer-side {
      max-width: 100%;
      min-width: 0;
      grid-template-columns: 1fr 1fr;
    }
    .todays-offer-main {
      margin: 20px 0;
      min-width: 0;
      max-width: 100%;
      padding: 20px;
    }
  }
  @media (max-width: 600px) {
    .todays-offer-side {
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .todays-offer-main {
      padding: 10px;
    }
  }
</style>
